{% extends 'layouts/base.html' %}

{% block title %}Результаты рефакторинга{% endblock title %}

{% block content %}
    <div class="block_white" style="font-size: 18px;">
        {% if results.items %}
            {# Save link #}
            <form action="{% url 'refactoring:save_recommendation' %}" method="post" id="save_recommendations_form">
                {% csrf_token %}

                <input type="hidden" name="recommendation" value="{{ results }}">
                <input type="hidden" name="user" value="{{ user }}">
                <input type="hidden" name="code" value="{{ code }}">
                <a id="save_recommendations_link">Сохранить рекомендации</a>
            </form>

            {% for key, value in results.items %}
                <p>{{ key }}: <span class="code_item">{{ value }}</span></p> 
            {% endfor %}
        {% else %}
            <h1 style='text-align: center;'>Приложение не нашло грязного кода!</h1>
        {% endif %}
    </div>

    {% if results.items %}
        <div style='margin-top: 25px; text-align: center;'>
            <div class="row">
                <div class="col-md-4 offset-md-2">
                    <a href="{% url 'refactoring:manual_input' %}">
                        <input class='button_blue' type="submit" value="Отрефакторить еще раз" style="font-size: 18px !important;">
                    </a>
                </div>

                <div class="col-md-4">
                    <a href="{% url 'refactoring:index' %}">
                        <input class='button_blue' type="submit" value="Главная" style="font-size: 18px !important;">
                    </a>
                </div>
            </div>
        </div>

        <div>
            <h2 class="text_middle">Вы можете скачать рекомендации</h2>

            <div class="row">
                <div class="col-md-4">
                    <form action="{% url 'refactoring:download_pdf' %}" method="post">
                        {% csrf_token %}

                        <input type="hidden" name="results" value="{{ results }}">
                        <input type="submit" class="button_green" value="PDF">
                    </form>
                </div>

                <div class="col-md-4">
                    <form action="{% url 'refactoring:download_json' %}" method="post">
                        {% csrf_token %}

                        <input type="hidden" name="results" value="{{ results }}">
                        <input type="submit" class="button_green" value="JSON">
                    </form>
                </div>

                <div class="col-md-4">

                    <form action="{% url 'refactoring:download_xml' %}" method="post">
                        {% csrf_token %}

                        <input type="hidden" name="results" value="{{ results }}">
                        <input type="submit" class="button_green" value="XML">
                    </form>
                </div>
            </div>
        </div>
    {% else %}
        <div style='margin-top: 25px; text-align: center;'>
            <a href="{% url 'refactoring:index' %}">
                <input class='button_green' type="submit" value="Главная" style="font-size: 18px !important;">
            </a>
        </div>
    {% endif %}

    <script>
        $(document).ready(function () {
            $('#save_recommendations_form').on('submit', function () {
                $.ajax({
                    data: $(this).serialize(),
                    url: "{% url 'refactoring:save_recommendation' %}",
                    success: function (response) {
                        $('#save_recommendations_form').hide()
                    }
                });

                return false;
            });
        })
    </script>
{% endblock content %}
